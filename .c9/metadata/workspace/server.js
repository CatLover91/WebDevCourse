{"changed":true,"filter":false,"title":"server.js","tooltip":"/server.js","value":"var Users = new Mongo.collection(\"users\");\nvar Questions = new Mongo.Collection(\"questions\");\nvar Answers = new Mongo.Collection(\"answers\");\n\nif (Meteor.isClient) {\n  // Client side computation\n  Meteor.subscribe(\"questions\");\n  Meteor.subscribe(\"answers\");\n\n  Template.body.events({\n    \"submit .new-question\": function (event) {\n\n      var text = event.target.text.value;\n\n      Meteor.call(\"addQuestion\", text);\n\n      // Clear form\n      event.target.text.value = \"\";\n\n      // Prevent default form submit\n      return false;\n    }\n  });\n\n  Template.question.events({\n    \"submit .new-answer\": function (event) {\n\n      var text = event.target.text.value;\n\n      Meteor.call(\"addAnswer\", text);\n\n      // Clear form\n      event.target.text.value = \"\";\n\n      // Prevent default form submit\n      return false;\n    },\n    \"click .up-vote\": function () {\n      Meteor.call(\"upVote\", this._id);\n    },\n    \"click .down-vote\": function () {\n      Meteor.call(\"downVote\", this._id);\n    }\n  });\n\n  Template.answer.events({\n    \"click .toggle-best\": function () {\n      // Set the checked property to the opposite of its current value\n      Meteor.call(\"setBest\", this._id);\n    },\n    \"click .up-vote\": function () {\n      Meteor.call(\"upVote\", this._id);\n    },\n    \"click .down-vote\": function () {\n      Meteor.call(\"downVote\", this._id);\n    }\n  });\n\n  Accounts.ui.config({\n    passwordSignupFields: \"USERNAME_ONLY\"\n  });\n}\n\nMeteor.methods({\n  addQuastion: function(title, content) {\n    if (! Meteor.userId()) {\n      throw new Meteor.Error(\"not-authorized\");\n    }\n\n    Questions.insert({\n        asker: Meteor.userId(),\n        title: title,\n        content: content,\n        bestAnswer: null,\n        timestamp: new Date()\n    });\n  },\n  addAnswer: function(title, content, question) {\n    if (! Meteor.userId()) {\n      throw new Meteor.Error(\"not0authorized\");\n    }\n\n    Answers.insert({\n      answerer: Meteor.userId(),\n      questionId: question.id(),\n      title: title,\n      content: content,\n      best: false,\n      value: 0,\n      voters: {},\n      timestamp: new Date()\n    });\n  },\n  setBest: function (answerId) {\n    var answer = Answers.findOne(answerId);\n    var question = Questions.findOne(answer.question)\n\n    if (question.asker !== Meteor.userId()) {\n      throw new Meteor.Error(\"not-authorized\");\n    }\n\n    if(question.bestAnswer === null) {\n\n      // If this is the first best answer\n\n      Answers.update(answerId, { $set: { best: true} });\n      Questions.update(answer.question, { $set: {bestAnswer: answerId} })\n\n    } else if(question.bestAnswer === answerId) {\n\n      // if this is already set as best, de-set it\n\n      Answers.update(answerId, { $set: { best: false} });\n      Questions.update(answer.question, { $set: {bestAnswer: null} })\n\n    } else {\n\n      // if another answer is selected, select this one instead\n\n      Answers.update(question.bestAnswer, { $set: {best: false} });\n      Answers.update(answerId, { $set: {best: true} });\n    }\n  },\n  upVote: function (answerId) {\n    var answer = Answers.findOne(answerId);\n\n    // users can't vote on their own answer\n    if (answer.answerer === Meteor.userId()) {\n      throw new Meteor.Error(\"not-authorized\");\n    }\n\n    // Did you already vote?\n    if(Meteor.userId() in answer.voters) {\n      // Yes you did\n\n      if(answer.voters.userId() == true) {\n        // retract vote\n\n        answer.value -= 1;\n        Answers.update(answerId, { $set: {value: answer.value}, $unset: {voters[Meteor.userId()]: \"\"} })\n\n      } else {\n        // change vote\n\n        answer.value += 2;\n        Answers.update(answerId, { $set: {value: answer.value}, $set: {voters[Meteor.userId()]: true} });\n      }\n    } else {\n      // No you didn't\n\n      answer.value += 1;\n      Answers.update(answerId, { $set: {value: answer.value}, $set {voters[Meteor.userId()]: true} })\n    }\n  },\n  downVote: function (answerId) {\n    var answer = Answers.findOne(answerId);\n\n    // users can't vote on their own answer\n    if (answer.answerer === Meteor.userId()) {\n      throw new Meteor.Error(\"not-authorized\");\n    }\n\n    // Did you already vote?\n    if(Meteor.userId() in answer.voters) {\n      // Yes you did\n\n      if(answer.voters.userId() == false) {\n        // retract vote\n\n        answer.value += 1;\n        Answers.update(answerId, { $set: {value: answer.value}, $unset: {voters[Meteor.userId()]: \"\"} })\n      } else {\n        // change vote\n\n        answer.value -= 2;\n        Answers.update(answerId, { $set: {value: answer.value}, $set: {voters[Meteor.userId()]: false} });\n      }\n    } else {\n      // No you didn't\n\n      answer.value -= 1;\n      Answers.update(answerId, { $set: {value: answer.value}, $set {voters[Meteor.userId()]: false} })\n    }\n  }\n});\n\nif (Meteor.isServer) {\n  // Server side computation\n\n}","undoManager":{"mark":-2,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":152,"column":46},"end":{"row":152,"column":47},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":6},"end":{"row":151,"column":7},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":7},"end":{"row":151,"column":8},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":8},"end":{"row":151,"column":9},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":9},"end":{"row":151,"column":10},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":10},"end":{"row":151,"column":11},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":11},"end":{"row":151,"column":12},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":12},"end":{"row":151,"column":13},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":13},"end":{"row":151,"column":14},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":14},"end":{"row":151,"column":15},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":15},"end":{"row":151,"column":16},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":16},"end":{"row":151,"column":17},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":17},"end":{"row":151,"column":18},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":18},"end":{"row":151,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":19},"end":{"row":151,"column":20},"action":"insert","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":20},"end":{"row":151,"column":21},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":21},"end":{"row":151,"column":22},"action":"insert","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":21},"end":{"row":151,"column":22},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":21},"end":{"row":151,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":22},"end":{"row":151,"column":23},"action":"insert","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":23},"end":{"row":151,"column":24},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":47},"end":{"row":152,"column":48},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":48},"end":{"row":152,"column":49},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":49},"end":{"row":152,"column":50},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":50},"end":{"row":152,"column":51},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":51},"end":{"row":152,"column":52},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":52},"end":{"row":152,"column":53},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":53},"end":{"row":152,"column":54},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":54},"end":{"row":152,"column":55},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":55},"end":{"row":152,"column":56},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":56},"end":{"row":152,"column":57},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":57},"end":{"row":152,"column":58},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":58},"end":{"row":152,"column":59},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":60},"end":{"row":152,"column":61},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":61},"end":{"row":152,"column":62},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":62},"end":{"row":152,"column":63},"action":"insert","lines":["$"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":63},"end":{"row":152,"column":64},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":64},"end":{"row":152,"column":65},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":65},"end":{"row":152,"column":66},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":66},"end":{"row":152,"column":67},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":67},"end":{"row":152,"column":69},"action":"insert","lines":["{}"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":68},"end":{"row":152,"column":69},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":69},"end":{"row":152,"column":70},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":70},"end":{"row":152,"column":71},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":71},"end":{"row":152,"column":72},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":72},"end":{"row":152,"column":73},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":73},"end":{"row":152,"column":74},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":74},"end":{"row":152,"column":76},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":75},"end":{"row":152,"column":76},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":76},"end":{"row":152,"column":77},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":77},"end":{"row":152,"column":78},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":78},"end":{"row":152,"column":79},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":79},"end":{"row":152,"column":80},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":80},"end":{"row":152,"column":81},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":81},"end":{"row":152,"column":82},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":82},"end":{"row":152,"column":83},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":83},"end":{"row":152,"column":84},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":84},"end":{"row":152,"column":85},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":85},"end":{"row":152,"column":86},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":86},"end":{"row":152,"column":87},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":87},"end":{"row":152,"column":88},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":88},"end":{"row":152,"column":90},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":91},"end":{"row":152,"column":92},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":92},"end":{"row":152,"column":93},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":93},"end":{"row":152,"column":94},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":94},"end":{"row":152,"column":95},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":95},"end":{"row":152,"column":96},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":96},"end":{"row":152,"column":97},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":98},"end":{"row":152,"column":99},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":147,"column":100},"end":{"row":147,"column":101},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":156,"column":4},"end":{"row":163,"column":4},"action":"remove","lines":["var answer = Answers.findOne(answerId);","    ","    // users can't vote on their own answer","    if (answer.answerer === Meteor.userId()) {","      throw new Meteor.Error(\"not-authorized\");","    }","    ","    "]},{"start":{"row":156,"column":4},"end":{"row":185,"column":5},"action":"insert","lines":["var answer = Answers.findOne(answerId);","    ","    // users can't vote on their own answer","    if (answer.answerer === Meteor.userId()) {","      throw new Meteor.Error(\"not-authorized\");","    }","    ","    // Did you already vote?","    if(Meteor.userId() in answer.voters) {","      // Yes you did","      ","      if(answer.voters.userId() == true) {","        // retract vote","        ","        answer.value -= 1;","        ","        Answers.update(answerId, { $set: {value: answer.value}, $unset: {voters[Meteor.userId()]: \"\"} })","        ","      } else {","        // change vote","","        answer.value += 2;","        ","        Answers.update(answerId, { $set: {value: answer.value}, $set: {voters[Meteor.userId()]: true} });","      }","    } else {","      // No you didn't","      answer.value += 1;","      Answers.update(answerId, { $set: {value: answer.value}, $set {voters[Meteor.userId()]: true} })","    }"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":35},"end":{"row":167,"column":39},"action":"remove","lines":["true"]},{"start":{"row":167,"column":35},"end":{"row":167,"column":36},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":36},"end":{"row":167,"column":37},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":37},"end":{"row":167,"column":38},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":38},"end":{"row":167,"column":39},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":39},"end":{"row":167,"column":40},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":170,"column":21},"end":{"row":170,"column":22},"action":"remove","lines":["-"]}]}],[{"group":"doc","deltas":[{"start":{"row":170,"column":21},"end":{"row":170,"column":22},"action":"insert","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":177,"column":21},"end":{"row":177,"column":22},"action":"remove","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":177,"column":21},"end":{"row":177,"column":22},"action":"insert","lines":["-"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":19},"end":{"row":183,"column":20},"action":"remove","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":19},"end":{"row":183,"column":20},"action":"insert","lines":["-"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":96},"end":{"row":179,"column":100},"action":"remove","lines":["true"]},{"start":{"row":179,"column":96},"end":{"row":179,"column":97},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":97},"end":{"row":179,"column":98},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":98},"end":{"row":179,"column":99},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":99},"end":{"row":179,"column":100},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":100},"end":{"row":179,"column":101},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":93},"end":{"row":184,"column":97},"action":"remove","lines":["true"]},{"start":{"row":184,"column":93},"end":{"row":184,"column":94},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":94},"end":{"row":184,"column":95},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":95},"end":{"row":184,"column":96},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":96},"end":{"row":184,"column":97},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":97},"end":{"row":184,"column":98},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":31},"end":{"row":70,"column":32},"action":"remove","lines":[" "]},{"start":{"row":125,"column":0},"end":{"row":125,"column":4},"action":"remove","lines":["    "]},{"start":{"row":130,"column":0},"end":{"row":130,"column":4},"action":"remove","lines":["    "]},{"start":{"row":134,"column":0},"end":{"row":134,"column":6},"action":"remove","lines":["      "]},{"start":{"row":137,"column":0},"end":{"row":137,"column":8},"action":"remove","lines":["        "]},{"start":{"row":139,"column":0},"end":{"row":139,"column":8},"action":"remove","lines":["        "]},{"start":{"row":141,"column":0},"end":{"row":141,"column":8},"action":"remove","lines":["        "]},{"start":{"row":146,"column":0},"end":{"row":146,"column":8},"action":"remove","lines":["        "]},{"start":{"row":157,"column":0},"end":{"row":157,"column":4},"action":"remove","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"remove","lines":["    "]},{"start":{"row":166,"column":0},"end":{"row":166,"column":6},"action":"remove","lines":["      "]},{"start":{"row":169,"column":0},"end":{"row":169,"column":8},"action":"remove","lines":["        "]},{"start":{"row":171,"column":0},"end":{"row":171,"column":8},"action":"remove","lines":["        "]},{"start":{"row":173,"column":0},"end":{"row":173,"column":8},"action":"remove","lines":["        "]},{"start":{"row":178,"column":0},"end":{"row":178,"column":8},"action":"remove","lines":["        "]}]}],[{"group":"doc","deltas":[{"start":{"row":150,"column":22},"end":{"row":151,"column":0},"action":"insert","lines":["",""]},{"start":{"row":151,"column":0},"end":{"row":151,"column":6},"action":"insert","lines":["      "]}]}],[{"group":"doc","deltas":[{"start":{"row":178,"column":26},"end":{"row":179,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":182,"column":22},"end":{"row":183,"column":0},"action":"insert","lines":["",""]},{"start":{"row":183,"column":0},"end":{"row":183,"column":6},"action":"insert","lines":["      "]}]}],[{"group":"doc","deltas":[{"start":{"row":171,"column":26},"end":{"row":172,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":104},"end":{"row":173,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":26},"end":{"row":146,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":138,"column":26},"end":{"row":139,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":149,"column":0},"end":{"row":149,"column":6},"action":"remove","lines":["      "]},{"start":{"row":179,"column":0},"end":{"row":179,"column":6},"action":"remove","lines":["      "]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":36,"column":6},"end":{"row":36,"column":6},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1425343062000}